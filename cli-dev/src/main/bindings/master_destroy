#!/bin/bash

function master_destroy {
  echo WARNING: this destroys everything mercilessly
  echo \<Return\> to continue, or Ctrl-C to exit
  read

  if [ -z "`zfs list lxc/master`" ]; then
    echo No zfs dataset \'lxc/master\' found - aborting ...
    exit 1
  fi

  zfs release keep lxc/master-opt@template
  zfs destroy -r lxc/master-opt

  zfs release keep lxc-data/master-var@template
  zfs destroy -r lxc-data/master-var

  zfs release keep lxc-data/master-home@template
  zfs destroy -r lxc-data/master-home

  zfs release keep lxc/master@template
  zfs destroy -r lxc/master
  lxc-destroy -n master
  
  # Check if master destroy is succesfull
  stat=$?
  if [ $stat != 0  ]; then
    echo "Could not destroy master, not continuing..."
    exit 1
  fi

  # Remove relevant directories under $SUBUTAI_TMPDIR if any
  local container="master"
  local package_name=`get_package_name $container`

  # Check if the package is installed
  dpkg -s $package_name
  if [ $stat = 0  ]; then
    apt-get --assume-yes --force-yes purge $package_name
  fi

  local debian_root="$SUBUTAI_TMPDIR/$container"
  rm -rf $debian_root
}


function master_destroy_description {
  echo destroys the master template
}



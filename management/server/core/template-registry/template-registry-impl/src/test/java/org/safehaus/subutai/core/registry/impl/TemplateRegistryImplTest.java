package org.safehaus.subutai.core.registry.impl;


import java.util.Iterator;
import java.util.concurrent.atomic.AtomicBoolean;

import org.junit.Before;
import org.junit.Test;
import org.safehaus.subutai.common.settings.Common;
import org.safehaus.subutai.core.db.api.DBException;
import org.safehaus.subutai.core.db.api.DbManager;
import org.safehaus.subutai.core.registry.api.RegistryException;
import org.safehaus.subutai.core.registry.api.Template;

import com.datastax.driver.core.ResultSet;
import com.datastax.driver.core.Row;

import static org.mockito.Matchers.any;
import static org.mockito.Matchers.anyVararg;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;


/**
 * Created by talas on 10/1/14.
 */
public class TemplateRegistryImplTest
{
    private TemplateRegistryImpl templateRegistry;
    private DbManager dbManager;
    private String configFile = "# Template used to create this container: /usr/share/lxc/templates/lxc-ubuntu\n"
            + "# Parameters passed to the template: -u subutai -S /root/.ssh/id_dsa.pub\n"
            + "# For additional config options, please look at lxc.conf(5)\n" + "\n" + "# Common configuration\n"
            + "lxc.include = /usr/share/lxc/config/ubuntu.common.conf\n" + "\n" + "# Container specific configuration\n"
            + "lxc.rootfs = /var/lib/lxc/hadoop/rootfs\n" + "lxc.mount = /var/lib/lxc/hadoop/fstab\n"
            + "lxc.utsname = hadoop\n" + "lxc.arch = amd64\n" + "\n" + "# Network configuration\n"
            + "lxc.network.type = veth\n" + "lxc.network.flags = up\n" + "lxc.network.link = br0\n"
            + "lxc.network.hwaddr = 00:16:3e:5:5e:67\n" + "subutai.config.path = /etc\n"
            + "lxc.hook.pre-start = /usr/bin/pre_start_hook\n" + "subutai.parent = master\n"
            + "subutai.git.branch = hadoop\n" + "lxc.mount.entry = /lxc/hadoop-opt opt none bind,rw 0 0\n"
            + "lxc.mount.entry = /lxc-data/hadoop-home home none bind,rw 0 0\n"
            + "lxc.mount.entry = /lxc-data/hadoop-var var none bind,rw 0 0\n"
            + "subutai.git.uuid = ba7e115e4b6aa0f424a64e44e726c56dd7ba1c9e\n"
            + "subutai.template.package = /lxc-data/tmpdir/hadoop-subutai-template_2.1.0_amd64.deb";

    private static String templateInfo = "{\n" + "    \"templateName\": \"master\",\n" + "    \"lxcArch\": \"amd64\",\n"
            + "    \"lxcUtsname\": \"master\",\n" + "    \"subutaiConfigPath\": \"/etc\",\n"
            + "    \"subutaiParent\": \"master\",\n" + "    \"subutaiGitBranch\": \"master\",\n"
            + "    \"subutaiGitUuid\": \"76cc7a05286c25889fb611661b63d45896cf13af\",\n"
            + "    \"packagesManifest\": \"Desired=Unknown/Install/Remove/Purge/Hold\\n| " +
            "Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\\n|/ Err?=(none)" +
            "/Reinst-required (Status,Err: uppercase=bad)\\n||/ Name                             Version             " +
            "          Architecture " +
            "Description\\n+++-================================-=============================-============-===============================================================================\\nii  acl                              2.2.52-1                      amd64        Access control list utilities\\nii  adduser                          3.113+nmu3ubuntu3             all          add and remove users and groups\\nii  apt                              1.0.1ubuntu2.1                amd64        commandline package manager\\nii  apt-utils                        1.0.1ubuntu2.1                amd64        package management related utility programs\\nii  at-spi2-core                     2.10.2.is.2.10.1-0ubuntu1     amd64        Assistive Technology Service Provider Interface (dbus core)\\nii  base-files                       7.2ubuntu5.1                  amd64        Debian base system miscellaneous files\\nii  base-passwd                      3.5.33                        amd64        Debian base system master password and group files\\nii  bash                             4.3-7ubuntu1                  amd64        GNU Bourne Again SHell\\nii  bsdutils                         1:2.20.1-5.1ubuntu20.1        amd64        Basic utilities from 4.4BSD-Lite\\nii  busybox-initramfs                1:1.21.0-1ubuntu1             amd64        Standalone shell setup for initramfs\\nii  bzip2                            1.0.6-5                       amd64        high-quality block-sorting file compressor - utilities\\nii  ca-certificates                  20130906ubuntu2               all          Common CA certificates\\nii  ca-certificates-java             20130815ubuntu1               all          Common CA certificates (JKS keystore)\\nii  collectd                         5.4.0-3ubuntu2                amd64        statistics collection and monitoring daemon\\nii  collectd-core                    5.4.0-3ubuntu2                amd64        statistics collection and monitoring daemon (core system)\\nii  colord                           1.0.6-1                       amd64        system service to manage device colour profiles -- system daemon\\nii  console-setup                    1.70ubuntu8                   all          console font and keymap setup program\\nii  coreutils                        8.21-1ubuntu5                 amd64        GNU core utilities\\nii  cpio                             2.11+dfsg-1ubuntu1            amd64        GNU cpio -- a program to manage archives of files\\nii  cpp                              4:4.8.2-1ubuntu6              amd64        GNU C preprocessor (cpp)\\nii  cpp-4.8                          4.8.2-19ubuntu1               amd64        GNU C preprocessor\\nii  cron                             3.0pl1-124ubuntu2             amd64        process scheduling daemon\\nii  dash                             0.5.7-4ubuntu1                amd64        POSIX-compliant shell\\nii  dbus                             1.6.18-0ubuntu4.1             amd64        simple interprocess messaging system (daemon and utilities)\\nii  dbus-x11                         1.6.18-0ubuntu4.1             amd64        simple interprocess messaging system (X11 deps)\\nii  dconf-gsettings-backend:amd64    0.20.0-1                      amd64        simple configuration storage system - GSettings back-end\\nii  dconf-service                    0.20.0-1                      amd64        simple configuration storage system - D-Bus service\\nii  debconf                          1.5.51ubuntu2                 all          Debian configuration management system\\nii  debconf-i18n                     1.5.51ubuntu2                 all          full internationalization support for debconf\\nii  debianutils                      4.4                           amd64        Miscellaneous utilities specific to Debian\\nii  default-jre-headless             2:1.7-51                      amd64        Standard Java or Java compatible Runtime (headless)\\nii  desktop-file-utils               0.22-1ubuntu1                 amd64        Utilities for .desktop files\\nii  dh-python                        1.20140128-1ubuntu8           all          Debian helper tools for packaging Python libraries and applications\\nii  diffutils                        1:3.3-1                       amd64        File comparison utilities\\nii  dmsetup                          2:1.02.77-6ubuntu2            amd64        Linux Kernel Device Mapper userspace library\\nii  dosfstools                       3.0.26-1                      amd64        utilities for making and checking MS-DOS FAT filesystems\\nii  dpkg                             1.17.5ubuntu5.3               amd64        Debian package management system\\nii  e2fslibs:amd64                   1.42.9-3ubuntu1               amd64        ext2/ext3/ext4 file system libraries\\nii  e2fsprogs                        1.42.9-3ubuntu1               amd64        ext2/ext3/ext4 file system utilities\\nii  eject                            2.1.5+deb1+cvs20081104-13.1   amd64        ejects CDs and operates CD-Changers under Linux\\nii  file                             1:5.14-2ubuntu3.1             amd64        Determines file type using \\\"magic\\\" numbers\\nii  findutils                        4.4.2-7                       amd64        utilities for finding files--find, xargs\\nii  fontconfig                       2.11.0-0ubuntu4.1             amd64        generic font configuration library - support binaries\\nii  fontconfig-config                2.11.0-0ubuntu4.1             all          generic font configuration library - configuration\\nii  fonts-dejavu                     2.34-1ubuntu1                 all          metapackage to pull in fonts-dejavu-core and fonts-dejavu-extra\\nii  fonts-dejavu-core                2.34-1ubuntu1                 all          Vera font family derivate with additional characters\\nii  fonts-dejavu-extra               2.34-1ubuntu1                 all          Vera font family derivate with additional characters (extra variants)\\nii  fuse                             2.9.2-4ubuntu4                amd64        Filesystem in Userspace\\nii  ganglia-monitor                  3.6.0-1ubuntu2                amd64        cluster monitoring toolkit - node daemon\\nii  gcc-4.8-base:amd64               4.8.2-19ubuntu1               amd64        GCC, the GNU Compiler Collection (base package)\\nii  gcc-4.9-base:amd64               4.9.1-0ubuntu1                amd64        GCC, the GNU Compiler Collection (base package)\\nii  gconf-service                    3.2.6-0ubuntu2                amd64        GNOME configuration database system (D-Bus service)\\nii  gconf-service-backend            3.2.6-0ubuntu2                amd64        GNOME configuration database system (D-Bus service)\\nii  gconf2                           3.2.6-0ubuntu2                amd64        GNOME configuration database system (support tools)\\nii  gconf2-common                    3.2.6-0ubuntu2                all          GNOME configuration database system (common files)\\nii  gdisk                            0.8.8-1build1                 amd64        GPT fdisk text-mode partitioning tool\\nii  git                              1:1.9.1-1                     amd64        fast, scalable, distributed revision control system\\nii  git-man                          1:1.9.1-1                     all          fast, scalable, distributed revision control system (manual pages)\\nii  gnupg                            1.4.16-1ubuntu2.1             amd64        GNU privacy guard - a free PGP replacement\\nii  gpgv                             1.4.16-1ubuntu2.1             amd64        GNU privacy guard - signature verification tool\\nii  grep                             2.16-1                        amd64        GNU grep, egrep and fgrep\\nii  groff-base                       1.22.2-5                      amd64        GNU troff text-formatting system (base system components)\\nii  gvfs:amd64                       1.20.1-1ubuntu1               amd64        userspace virtual filesystem - GIO module\\nii  gvfs-common                      1.20.1-1ubuntu1               all          userspace virtual filesystem - common data files\\nii  gvfs-daemons                     1.20.1-1ubuntu1               amd64        userspace virtual filesystem - servers\\nii  gvfs-libs:amd64                  1.20.1-1ubuntu1               amd64        userspace virtual filesystem - private libraries\\nii  gzip                             1.6-3ubuntu1                  amd64        GNU compression utilities\\nii  hicolor-icon-theme               0.13-1                        all          default fallback theme for FreeDesktop.org icon themes\\nii  hostname                         3.15ubuntu1                   amd64        utility to set/show the host name or domain name\\nii  icedtea-7-jre-jamvm:amd64        7u65-2.5.1-4ubuntu1~0.14.04.2 amd64        Alternative JVM for OpenJDK, using JamVM\\nii  ifupdown                         0.7.47.2ubuntu4.1             amd64        high level tools to configure network interfaces\\nii  init-system-helpers              1.14                          all          helper tools for all init systems\\nii  initramfs-tools                  0.103ubuntu4.2                all          tools for generating an initramfs\\nii  initramfs-tools-bin              0.103ubuntu4.2                amd64        binaries used by initramfs-tools\\nii  initscripts                      2.88dsf-41ubuntu6             amd64        scripts for initializing and shutting down the system\\nii  insserv                          1.14.0-5ubuntu2               amd64        boot sequence organizer using LSB init.d script dependency information\\nii  iproute2                         3.12.0-2                      amd64        networking and traffic control tools\\nii  iptables                         1.4.21-1ubuntu1               amd64        administration tools for packet filtering and NAT\\nii  iputils-ping                     3:20121221-4ubuntu1.1         amd64        Tools to test the reachability of network hosts\\nii  isc-dhcp-client                  4.2.4-7ubuntu12               amd64        ISC DHCP client\\nii  isc-dhcp-common                  4.2.4-7ubuntu12               amd64        common files used by all the isc-dhcp* packages\\nii  java-common                      0.51                          all          Base of all Java packages\\nii  jmxtrans                         1.0.1                         all          master-jmxtrans-ab6cfd36e3 - jmxtrans\\nii  kbd                              1.15.5-1ubuntu1               amd64        Linux console font and keytable utilities\\nii  keyboard-configuration           1.70ubuntu8                   all          system-wide keyboard preferences\\nii  klibc-utils                      2.0.3-0ubuntu1                amd64        small utilities built with klibc for early boot\\nii  kmod                             15-0ubuntu6                   amd64        tools for managing Linux kernel modules\\nii  ksks-logstash                    1.0.1                         amd64        This is a logstash package of kiskis distribution.\\nii  language-pack-en                 1:14.04+20140707              all          translation updates for language English\\nii  language-pack-en-base            1:14.04+20140707              all          translations for language English\\nii  less                             458-2                         amd64        pager program similar to more\\nii  libacl1:amd64                    2.2.52-1                      amd64        Access control list shared library\\nii  libapparmor1:amd64               2.8.95~2430-0ubuntu5          amd64        changehat AppArmor library\\nii  libapr1:amd64                    1.5.0-1                       amd64        Apache Portable Runtime Library\\nii  libapt-inst1.5:amd64             1.0.1ubuntu2.1                amd64        deb package format runtime library\\nii  libapt-pkg4.12:amd64             1.0.1ubuntu2.1                amd64        package management runtime library\\nii  libarchive-extract-perl          0.70-1                        all          generic archive extracting module\\nii  libasn1-8-heimdal:amd64          1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - ASN.1 library\\nii  libasound2:amd64                 1.0.27.2-3ubuntu7             amd64        shared library for ALSA applications\\nii  libasound2-data                  1.0.27.2-3ubuntu7             all          Configuration files and profiles for ALSA drivers\\nii  libasyncns0:amd64                0.8-4ubuntu2                  amd64        Asynchronous name service query library\\nii  libatasmart4:amd64               0.19-3                        amd64        ATA S.M.A.R.T. reading and parsing library\\nii  libatk-bridge2.0-0:amd64         2.10.2-2ubuntu1               amd64        AT-SPI 2 toolkit bridge - shared library\\nii  libatk-wrapper-java              0.30.4-4                      all          ATK implementation for Java using JNI\\nii  libatk-wrapper-java-jni:amd64    0.30.4-4                      amd64        ATK implementation for Java using JNI (JNI bindings)\\nii  libatk1.0-0:amd64                2.10.0-2ubuntu2               amd64        ATK accessibility toolkit\\nii  libatk1.0-data                   2.10.0-2ubuntu2               all          Common files for the ATK accessibility toolkit\\nii  libatspi2.0-0:amd64              2.10.2.is.2.10.1-0ubuntu1     amd64        Assistive Technology Service Provider Interface - shared library\\nii  libattr1:amd64                   1:2.4.47-1ubuntu1             amd64        Extended attribute shared library\\nii  libaudit-common                  1:2.3.2-2ubuntu1              all          Dynamic library for security auditing - common files\\nii  libaudit1:amd64                  1:2.3.2-2ubuntu1              amd64        Dynamic library for security auditing\\nii  libavahi-client3:amd64           0.6.31-4ubuntu1               amd64        Avahi client library\\nii  libavahi-common-data:amd64       0.6.31-4ubuntu1               amd64        Avahi common data files\\nii  libavahi-common3:amd64           0.6.31-4ubuntu1               amd64        Avahi common library\\nii  libavahi-glib1:amd64             0.6.31-4ubuntu1               amd64        Avahi GLib integration library\\nii  libblkid1:amd64                  2.20.1-5.1ubuntu20.1          amd64        block device id library\\nii  libbonobo2-0:amd64               2.32.1-0ubuntu5               amd64        Bonobo CORBA interfaces library\\nii  libbonobo2-common                2.32.1-0ubuntu5               all          Bonobo CORBA interfaces library -- support files\\nii  libbsd0:amd64                    0.6.0-2ubuntu1                amd64        utility functions from BSD systems - shared library\\nii  libbz2-1.0:amd64                 1.0.6-5                       amd64        high-quality block-sorting file compressor library - runtime\\nii  libc-bin                         2.19-0ubuntu6.3               amd64        Embedded GNU C Library: Binaries\\nii  libc6:amd64                      2.19-0ubuntu6.3               amd64        Embedded GNU C Library: Shared libraries\\nii  libcairo-gobject2:amd64          1.13.0~20140204-0ubuntu1      amd64        The Cairo 2D vector graphics library (GObject library)\\nii  libcairo2:amd64                  1.13.0~20140204-0ubuntu1      amd64        The Cairo 2D vector graphics library\\nii  libcanberra-gtk3-0:amd64         0.30-0ubuntu3                 amd64        GTK+ 3.0 helper for playing widget event sounds with libcanberra\\nii  libcanberra-gtk3-module:amd64    0.30-0ubuntu3                 amd64        translates GTK3 widgets signals to event sounds\\nii  libcanberra0:amd64               0.30-0ubuntu3                 amd64        simple abstract interface for playing event sounds\\nii  libcap-ng0                       0.7.3-1ubuntu2                amd64        An alternate POSIX capabilities library\\nii  libcap2:amd64                    1:2.24-0ubuntu2               amd64        support for getting/setting POSIX.1e capabilities\\nii  libcap2-bin                      1:2.24-0ubuntu2               amd64        basic utility programs for using capabilities\\nii  libcgmanager0:amd64              0.24-0ubuntu7                 amd64        Central cgroup manager daemon (client library)\\nii  libck-connector0:amd64           0.4.5-3.1ubuntu2              amd64        ConsoleKit libraries\\nii  libcloog-isl4:amd64              0.18.2-1                      amd64        Chunky Loop Generator (runtime library)\\nii  libcolord1:amd64                 1.0.6-1                       amd64        system service to manage device colour profiles -- runtime\\nii  libcolorhug1:amd64               1.0.6-1                       amd64        library to access the ColorHug colourimeter -- runtime\\nii  libcomerr2:amd64                 1.42.9-3ubuntu1               amd64        common error description library\\nii  libconfuse-common                2.7-4ubuntu1                  all          Common files for libConfuse\\nii  libconfuse0:amd64                2.7-4ubuntu1                  amd64        Library for parsing configuration files\\nii  libcups2:amd64                   1.7.2-0ubuntu1.2              amd64        Common UNIX Printing System(tm) - Core library\\nii  libcurl3-gnutls:amd64            7.35.0-1ubuntu2.1             amd64        easy-to-use client-side URL transfer library (GnuTLS flavour)\\nii  libdatrie1:amd64                 0.2.8-1                       amd64        Double-array trie library\\nii  libdb5.3:amd64                   5.3.28-3ubuntu3               amd64        Berkeley v5.3 Database Libraries [runtime]\\nii  libdbi1:amd64                    0.9.0-1                       amd64        DB Independent Abstraction Layer for C -- shared library\\nii  libdbus-1-3:amd64                1.6.18-0ubuntu4.1             amd64        simple interprocess messaging system (library)\\nii  libdbus-glib-1-2:amd64           0.100.2-1                     amd64        simple interprocess messaging system (GLib-based shared library)\\nii  libdconf1:amd64                  0.20.0-1                      amd64        simple configuration storage system - runtime library\\nii  libdebconfclient0:amd64          0.187ubuntu1                  amd64        Debian Configuration Management System (C-implementation library)\\nii  libdevmapper-event1.02.1:amd64   2:1.02.77-6ubuntu2            amd64        Linux Kernel Device Mapper event support library\\nii  libdevmapper1.02.1:amd64         2:1.02.77-6ubuntu2            amd64        Linux Kernel Device Mapper userspace library\\nii  libdrm-intel1:amd64              2.4.52-1                      amd64        Userspace interface to intel-specific kernel DRM services -- runtime\\nii  libdrm-nouveau2:amd64            2.4.52-1                      amd64        Userspace interface to nouveau-specific kernel DRM services -- runtime\\nii  libdrm-radeon1:amd64             2.4.52-1                      amd64        Userspace interface to radeon-specific kernel DRM services -- runtime\\nii  libdrm2:amd64                    2.4.52-1                      amd64        Userspace interface to kernel DRM services -- runtime\\nii  libedit2:amd64                   3.1-20130712-2                amd64        BSD editline and history libraries\\nii  libelf1:amd64                    0.158-0ubuntu5.1              amd64        library to read and write ELF files\\nii  liberror-perl                    0.17-1.1                      all          Perl module for error/exception handling in an OO-ish way\\nii  libesmtp6                        1.0.6-1ubuntu2                amd64        LibESMTP SMTP client library\\nii  libestr0                         0.1.9-0ubuntu2                amd64        Helper functions for handling strings (lib)\\nii  libexif12:amd64                  0.6.21-1ubuntu1               amd64        library to parse EXIF files\\nii  libexpat1:amd64                  2.1.0-4ubuntu1                amd64        XML parsing C library - runtime library\\nii  libffi6:amd64                    3.1~rc1+r3.0.13-12            amd64        Foreign Function Interface library runtime\\nii  libflac8:amd64                   1.3.0-2                       amd64        Free Lossless Audio Codec - runtime C library\\nii  libfontconfig1:amd64             2.11.0-0ubuntu4.1             amd64        generic font configuration library - runtime\\nii  libfontenc1:amd64                1:1.1.2-1                     amd64        X11 font encoding library\\nii  libfreetype6:amd64               2.5.2-1ubuntu2.2              amd64        FreeType 2 font engine, shared library files\\nii  libfribidi0:amd64                0.19.6-1                      amd64        Free Implementation of the Unicode BiDi algorithm\\nii  libfuse2:amd64                   2.9.2-4ubuntu4                amd64        Filesystem in Userspace (library)\\nii  libganglia1                      3.6.0-1ubuntu2                amd64        cluster monitoring toolkit - shared libraries\\nii  libgcc1:amd64                    1:4.9.1-0ubuntu1              amd64        GCC support library\\nii  libgconf-2-4:amd64               3.2.6-0ubuntu2                amd64        GNOME configuration database system (shared libraries)\\nii  libgconf2-4:amd64                3.2.6-0ubuntu2                amd64        GNOME configuration database system (dummy package)\\nii  libgcrypt11:amd64                1.5.3-2ubuntu4.1              amd64        LGPL Crypto library - runtime library\\nii  libgd3:amd64                     2.1.0-3                       amd64        GD Graphics Library\\nii  libgdbm3:amd64                   1.8.3-12build1                amd64        GNU dbm database routines (runtime version)\\nii  libgdk-pixbuf2.0-0:amd64         2.30.7-0ubuntu1               amd64        GDK Pixbuf library\\nii  libgdk-pixbuf2.0-common          2.30.7-0ubuntu1               all          GDK Pixbuf library - data files\\nii  libgif4:amd64                    4.1.6-11                      amd64        library for GIF images (library)\\nii  libgl1-mesa-dri:amd64            10.1.3-0ubuntu0.1             amd64        free implementation of the OpenGL API -- DRI modules\\nii  libgl1-mesa-glx:amd64            10.1.3-0ubuntu0.1             amd64        free implementation of the OpenGL API -- GLX runtime\\nii  libglapi-mesa:amd64              10.1.3-0ubuntu0.1             amd64        free implementation of the GL API -- shared library\\nii  libglib2.0-0:amd64               2.40.0-2                      amd64        GLib library of C routines\\nii  libglib2.0-data                  2.40.0-2                      all          Common files for GLib library\\nii  libgmp10:amd64                   2:5.1.3+dfsg-1ubuntu1         amd64        Multiprecision arithmetic library\\nii  libgnome2-0:amd64                2.32.1-4ubuntu1               amd64        The GNOME library - runtime files\\nii  libgnome2-bin                    2.32.1-4ubuntu1               amd64        The GNOME library - binary files\\nii  libgnome2-common                 2.32.1-4ubuntu1               all          The GNOME library - common files\\nii  libgnomevfs2-0:amd64             1:2.24.4-1ubuntu6             amd64        GNOME Virtual File System (runtime libraries)\\nii  libgnomevfs2-common              1:2.24.4-1ubuntu6             amd64        GNOME Virtual File System (common files)\\nii  libgnutls-openssl27:amd64        2.12.23-12ubuntu2.1           amd64        GNU TLS library - OpenSSL wrapper\\nii  libgnutls26:amd64                2.12.23-12ubuntu2.1           amd64        GNU TLS library - runtime library\\nii  libgpg-error0:amd64              1.12-0.2ubuntu1               amd64        library for common error values and messages in GnuPG components\\nii  libgphoto2-6:amd64               2.5.3.1-1ubuntu2.2            amd64        gphoto2 digital camera library\\nii  libgphoto2-l10n                  2.5.3.1-1ubuntu2.2            all          gphoto2 digital camera library - localized messages\\nii  libgphoto2-port10:amd64          2.5.3.1-1ubuntu2.2            amd64        gphoto2 digital camera port library\\nii  libgpm2:amd64                    1.20.4-6.1                    amd64        General Purpose Mouse - shared library\\nii  libgraphite2-3:amd64             1.2.4-1ubuntu1                amd64        Font rendering engine for Complex Scripts -- library\\nii  libgssapi-krb5-2:amd64           1.12+dfsg-2ubuntu4.2          amd64        MIT Kerberos runtime libraries - krb5 GSS-API Mechanism\\nii  libgssapi3-heimdal:amd64         1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - GSSAPI support library\\nii  libgtk-3-0:amd64                 3.10.8-0ubuntu1.2             amd64        GTK+ graphical user interface library\\nii  libgtk-3-bin                     3.10.8-0ubuntu1.2             amd64        programs for the GTK+ graphical user interface library\\nii  libgtk-3-common                  3.10.8-0ubuntu1.2             all          common files for the GTK+ graphical user interface library\\nii  libgtk2.0-0:amd64                2.24.23-0ubuntu1.1            amd64        GTK+ graphical user interface library\\nii  libgtk2.0-bin                    2.24.23-0ubuntu1.1            amd64        programs for the GTK+ graphical user interface library\\nii  libgtk2.0-common                 2.24.23-0ubuntu1.1            all          common files for the GTK+ graphical user interface library\\nii  libgudev-1.0-0:amd64             1:204-5ubuntu20.6             amd64        GObject-based wrapper library for libudev\\nii  libgusb2:amd64                   0.1.6-5                       amd64        GLib wrapper around libusb1\\nii  libharfbuzz0b:amd64              0.9.27-1ubuntu1               amd64        OpenType text shaping engine (shared library)\\nii  libhcrypto4-heimdal:amd64        1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - crypto library\\nii  libheimbase1-heimdal:amd64       1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - Base library\\nii  libheimntlm0-heimdal:amd64       1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - NTLM support library\\nii  libhx509-5-heimdal:amd64         1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - X509 support library\\nii  libice6:amd64                    2:1.0.8-2                     amd64        X11 Inter-Client Exchange library\\nii  libicu52:amd64                   52.1-3                        amd64        International Components for Unicode\\nii  libidl-common                    0.8.14-0.2ubuntu4             all          library for parsing CORBA IDL files (common files)\\nii  libidl0:amd64                    0.8.14-0.2ubuntu4             amd64        library for parsing CORBA IDL files\\nii  libidn11:amd64                   1.28-1ubuntu2                 amd64        GNU Libidn library, implementation of IETF IDN specifications\\nii  libieee1284-3:amd64              0.2.11-12                     amd64        cross-platform library for parallel port access\\nii  libisl10:amd64                   0.12.2-1                      amd64        manipulating sets and relations of integer points bounded by linear constraints\\nii  libjasper1:amd64                 1.900.1-14ubuntu3             amd64        JasPer JPEG-2000 runtime library\\nii  libjbig0:amd64                   2.0-2ubuntu4.1                amd64        JBIGkit libraries\\nii  libjpeg-turbo8:amd64             1.3.0-0ubuntu2                amd64        IJG JPEG compliant runtime library.\\nii  libjpeg8:amd64                   8c-2ubuntu8                   amd64        Independent JPEG Group's JPEG runtime library (dependency package)\\nii  libjson-c2:amd64                 0.11-3ubuntu1.2               amd64        JSON manipulation library - shared library\\nii  libjson0:amd64                   0.11-3ubuntu1.2               amd64        JSON manipulation library (transitional package)\\nii  libk5crypto3:amd64               1.12+dfsg-2ubuntu4.2          amd64        MIT Kerberos runtime libraries - Crypto Library\\nii  libkeyutils1:amd64               1.5.6-1                       amd64        Linux Key Management Utilities (library)\\nii  libklibc                         2.0.3-0ubuntu1                amd64        minimal libc subset for use with initramfs\\nii  libkmod2:amd64                   15-0ubuntu6                   amd64        libkmod shared library\\nii  libkrb5-26-heimdal:amd64         1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - libraries\\nii  libkrb5-3:amd64                  1.12+dfsg-2ubuntu4.2          amd64        MIT Kerberos runtime libraries\\nii  libkrb5support0:amd64            1.12+dfsg-2ubuntu4.2          amd64        MIT Kerberos runtime libraries - Support library\\nii  liblcms2-2:amd64                 2.5-0ubuntu4                  amd64        Little CMS 2 color management library\\nii  libldap-2.4-2:amd64              2.4.31-1+nmu2ubuntu8          amd64        OpenLDAP libraries\\nii  libllvm3.4:amd64                 1:3.4-1ubuntu3                amd64        Modular compiler and toolchain technologies, runtime library\\nii  liblocale-gettext-perl           1.05-7build3                  amd64        module using libc functions for internationalization in Perl\\nii  liblockfile-bin                  1.09-6ubuntu1                 amd64        support binaries for and cli utilities based on liblockfile\\nii  liblockfile1:amd64               1.09-6ubuntu1                 amd64        NFS-safe locking library\\nii  liblog-message-simple-perl       0.10-1                        all          simplified interface to Log::Message\\nii  libltdl7:amd64                   2.4.2-1.7ubuntu1              amd64        A system independent dlopen wrapper for GNU libtool\\nii  liblvm2app2.2:amd64              2.02.98-6ubuntu2              amd64        LVM2 application library\\nii  liblzma5:amd64                   5.1.1alpha+20120614-2ubuntu2  amd64        XZ-format compression library\\nii  libmagic1:amd64                  1:5.14-2ubuntu3.1             amd64        File type determination library using \\\"magic\\\" numbers\\nii  libmemcached10:amd64             1.0.8-1ubuntu2                amd64        C and C++ client library to the memcached server\\nii  libmnl0:amd64                    1.0.3-3ubuntu1                amd64        minimalistic Netlink communication library\\nii  libmodbus5:amd64                 3.0.5-1                       amd64        library for the Modbus protocol\\nii  libmodule-pluggable-perl         5.1-1                         all          module for giving  modules the ability to have plugins\\nii  libmount1:amd64                  2.20.1-5.1ubuntu20.1          amd64        block device id library\\nii  libmpc3:amd64                    1.0.1-1ubuntu1                amd64        multiple precision complex floating-point library\\nii  libmpdec2:amd64                  2.4.0-6                       amd64        library for decimal floating point arithmetic (runtime library)\\nii  libmpfr4:amd64                   3.1.2-1                       amd64        multiple precision floating-point computation\\nii  libmysqlclient18:amd64           5.5.38-0ubuntu0.14.04.1       amd64        MySQL database client library\\nii  libncurses5:amd64                5.9+20140118-1ubuntu1         amd64        shared libraries for terminal handling\\nii  libncursesw5:amd64               5.9+20140118-1ubuntu1         amd64        shared libraries for terminal handling (wide character support)\\nii  libnewt0.52:amd64                0.52.15-2ubuntu5              amd64        Not Erik's Windowing Toolkit - text mode windowing with slang\\nii  libnfnetlink0:amd64              1.0.1-2                       amd64        Netfilter netlink library\\nii  libnih-dbus1:amd64               1.0.3-4ubuntu25               amd64        NIH D-Bus Bindings Library\\nii  libnih1:amd64                    1.0.3-4ubuntu25               amd64        NIH Utility Library\\nii  libnl-3-200:amd64                3.2.21-1                      amd64        library for dealing with netlink sockets\\nii  libnotify4:amd64                 0.7.6-1ubuntu3                amd64        sends desktop notifications to a notification daemon\\nii  libnspr4:amd64                   2:4.10.2-1ubuntu1.1           amd64        NetScape Portable Runtime Library\\nii  libnss3:amd64                    2:3.15.4-1ubuntu7.1           amd64        Network Security Service libraries\\nii  libnss3-1d:amd64                 2:3.15.4-1ubuntu7.1           amd64        Network Security Service libraries - transitional package\\nii  libnss3-nssdb                    2:3.15.4-1ubuntu7.1           all          Network Security Security libraries - shared databases\\nii  libnuma1:amd64                   2.0.9~rc5-1ubuntu2            amd64        Libraries for controlling NUMA policy\\nii  libogg0:amd64                    1.3.1-1ubuntu1                amd64        Ogg bitstream library\\nii  libopenipmi0                     2.0.18-0ubuntu7.1             amd64        Intelligent Platform Management Interface - runtime\\nii  liboping0:amd64                  1.6.2-4                       amd64        C/C++ library to generate ICMP ECHO_REQUESTs\\nii  liborbit-2-0:amd64               1:2.14.19-0.3                 amd64        high-performance CORBA implementation - common libraries\\nii  liborbit2:amd64                  1:2.14.19-0.3                 amd64        high-performance CORBA implementation - extra libraries\\nii  libp11-kit0:amd64                0.20.2-2ubuntu2               amd64        Library for loading and coordinating access to PKCS#11 modules - runtime\\nii  libpam-cap:amd64                 1:2.24-0ubuntu2               amd64        PAM module for implementing capabilities\\nii  libpam-modules:amd64             1.1.8-1ubuntu2                amd64        Pluggable Authentication Modules for PAM\\nii  libpam-modules-bin               1.1.8-1ubuntu2                amd64        Pluggable Authentication Modules for PAM - helper binaries\\nii  libpam-runtime                   1.1.8-1ubuntu2                all          Runtime support for the PAM library\\nii  libpam-systemd:amd64             204-5ubuntu20.6               amd64        system and service manager - PAM module\\nii  libpam0g:amd64                   1.1.8-1ubuntu2                amd64        Pluggable Authentication Modules library\\nii  libpango-1.0-0:amd64             1.36.3-1ubuntu1               amd64        Layout and rendering of internationalized text\\nii  libpangocairo-1.0-0:amd64        1.36.3-1ubuntu1               amd64        Layout and rendering of internationalized text\\nii  libpangoft2-1.0-0:amd64          1.36.3-1ubuntu1               amd64        Layout and rendering of internationalized text\\nii  libparted0debian1:amd64          2.3-19ubuntu1                 amd64        disk partition manipulator - shared library\\nii  libpcap0.8:amd64                 1.5.3-2                       amd64        system interface for user-level packet capture\\nii  libpciaccess0:amd64              0.13.2-1                      amd64        Generic PCI access library for X\\nii  libpcre3:amd64                   1:8.31-2ubuntu2               amd64        Perl 5 Compatible Regular Expression Library - runtime files\\nii  libpcsclite1:amd64               1.8.10-1ubuntu1               amd64        Middleware to access a smart card using PC/SC (library)\\nii  libperl5.18                      5.18.2-2ubuntu1               amd64        shared Perl library\\nii  libpixman-1-0:amd64              0.30.2-2ubuntu1               amd64        pixel-manipulation library for X and cairo\\nii  libplymouth2:amd64               0.8.8-0ubuntu17               amd64        graphical boot animation and logger - shared libraries\\nii  libpng12-0:amd64                 1.2.50-1ubuntu2               amd64        PNG library - runtime\\nii  libpod-latex-perl                0.61-1                        all          module to convert Pod data to formatted LaTeX\\nii  libpolkit-agent-1-0:amd64        0.105-4ubuntu2                amd64        PolicyKit Authentication Agent API\\nii  libpolkit-backend-1-0:amd64      0.105-4ubuntu2                amd64        PolicyKit backend API\\nii  libpolkit-gobject-1-0:amd64      0.105-4ubuntu2                amd64        PolicyKit Authorization API\\nii  libpopt0:amd64                   1.16-8ubuntu1                 amd64        lib for parsing cmdline parameters\\nii  libpq5                           9.3.5-0ubuntu0.14.04.1        amd64        PostgreSQL C client library\\nii  libprocps3:amd64                 1:3.3.9-1ubuntu2              amd64        library for accessing process information from /proc\\nii  libprotobuf-c0                   0.15-1build1                  amd64        Protocol Buffers C library\\nii  libpulse0:amd64                  1:4.0-0ubuntu11               amd64        PulseAudio client libraries\\nii  libpython-stdlib:amd64           2.7.5-5ubuntu3                amd64        interactive high-level object-oriented language (default python version)\\nii  libpython2.7:amd64               2.7.6-8                       amd64        Shared Python runtime library (version 2.7)\\nii  libpython2.7-minimal:amd64       2.7.6-8                       amd64        Minimal subset of the Python language (version 2.7)\\nii  libpython2.7-stdlib:amd64        2.7.6-8                       amd64        Interactive high-level object-oriented language (standard library, version 2.7)\\nii  libpython3-stdlib:amd64          3.4.0-0ubuntu2                amd64        interactive high-level object-oriented language (default python3 version)\\nii  libpython3.4-minimal:amd64       3.4.0-2ubuntu1                amd64        Minimal subset of the Python language (version 3.4)\\nii  libpython3.4-stdlib:amd64        3.4.0-2ubuntu1                amd64        Interactive high-level object-oriented language (standard library, version 3.4)\\nii  librabbitmq1                     0.4.1-1                       amd64        AMQP client library written in C\\nii  libreadline6:amd64               6.3-4ubuntu2                  amd64        GNU readline and history libraries, run-time libraries\\nii  libroken18-heimdal:amd64         1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - roken support library\\nii  librrd4                          1.4.7-2ubuntu5                amd64        time-series data storage and display system (runtime library)\\nii  librtmp0:amd64                   2.4+20121230.gitdf6c518-1     amd64        toolkit for RTMP streams (shared library)\\nii  libsane:amd64                    1.0.23-3ubuntu3.1             amd64        API library for scanners\\nii  libsane-common                   1.0.23-3ubuntu3.1             amd64        API library for scanners -- documentation and support files\\nii  libsasl2-2:amd64                 2.1.25.dfsg1-17build1         amd64        Cyrus SASL - authentication abstraction library\\nii  libsasl2-modules:amd64           2.1.25.dfsg1-17build1         amd64        Cyrus SASL - pluggable authentication modules\\nii  libsasl2-modules-db:amd64        2.1.25.dfsg1-17build1         amd64        Cyrus SASL - pluggable authentication modules (DB)\\nii  libsecret-1-0:amd64              0.16-0ubuntu1                 amd64        Secret store\\nii  libsecret-common                 0.16-0ubuntu1                 all          Secret store (common files)\\nii  libselinux1:amd64                2.2.2-1ubuntu0.1              amd64        SELinux runtime shared libraries\\nii  libsemanage-common               2.2-1                         all          Common files for SELinux policy management libraries\\nii  libsemanage1:amd64               2.2-1                         amd64        SELinux policy management library\\nii  libsensors4:amd64                1:3.3.4-2ubuntu1              amd64        library to read temperature/voltage/fan sensors\\nii  libsepol1:amd64                  2.2-1                         amd64        SELinux library for manipulating binary security policies\\nii  libslang2:amd64                  2.2.4-15ubuntu1               amd64        S-Lang programming library - runtime version\\nii  libsm6:amd64                     2:1.2.1-2                     amd64        X11 Session Management library\\nii  libsndfile1:amd64                1.0.25-7ubuntu2               amd64        Library for reading/writing audio files\\nii  libsnmp-base                     5.7.2~dfsg-8.1ubuntu3         all          SNMP configuration script, MIBs and documentation\\nii  libsnmp30:amd64                  5.7.2~dfsg-8.1ubuntu3         amd64        SNMP (Simple Network Management Protocol) library\\nii  libsqlite3-0:amd64               3.8.2-1ubuntu2                amd64        SQLite 3 shared library\\nii  libss2:amd64                     1.42.9-3ubuntu1               amd64        command-line interface parsing library\\nii  libssl1.0.0:amd64                1.0.1f-1ubuntu2.5             amd64        Secure Sockets Layer toolkit - shared libraries\\nii  libstdc++6:amd64                 4.8.2-19ubuntu1               amd64        GNU Standard C++ Library v3\\nii  libsystemd-daemon0:amd64         204-5ubuntu20.6               amd64        systemd utility library\\nii  libsystemd-login0:amd64          204-5ubuntu20.6               amd64        systemd login utility library\\nii  libtasn1-6:amd64                 3.4-3ubuntu0.1                amd64        Manage ASN.1 structures (runtime)\\nii  libtdb1:amd64                    1.2.12-1                      amd64        Trivial Database - shared library\\nii  libterm-ui-perl                  0.42-1                        all          Term::ReadLine UI made easy\\nii  libtext-charwidth-perl           0.04-7build3                  amd64        get display widths of characters on the terminal\\nii  libtext-iconv-perl               1.7-5build2                   amd64        converts between character sets in Perl\\nii  libtext-soundex-perl             3.4-1build1                   amd64        implementation of the soundex algorithm\\nii  libtext-wrapi18n-perl            0.06-7                        all          internationalized substitute of Text::Wrap\\nii  libthai-data                     0.1.20-3                      all          Data files for Thai language support library\\nii  libthai0:amd64                   0.1.20-3                      amd64        Thai language support library\\nii  libtiff5:amd64                   4.0.3-7ubuntu0.1              amd64        Tag Image File Format (TIFF) library\\nii  libtinfo5:amd64                  5.9+20140118-1ubuntu1         amd64        shared low-level terminfo library for terminal handling\\nii  libtokyocabinet9:amd64           1.4.48-2                      amd64        Tokyo Cabinet Database Libraries [runtime]\\nii  libtokyotyrant3                  1.1.40-4.2                    amd64        Tokyo Tyrant runtime libraries\\nii  libtxc-dxtn-s2tc0:amd64          0~git20131104-1.1             amd64        Texture compression library for Mesa\\nii  libudev1:amd64                   204-5ubuntu20.6               amd64        libudev shared library\\nii  libudisks2-0:amd64               2.1.3-1                       amd64        GObject based library to access udisks2\\nii  libupsclient3:amd64              2.7.1-1ubuntu1                amd64        network UPS tools - client library\\nii  libusb-0.1-4:amd64               2:0.1.12-23.3ubuntu1          amd64        userspace USB programming library\\nii  libusb-1.0-0:amd64               2:1.0.17-1ubuntu2             amd64        userspace USB programming library\\nii  libustr-1.0-1:amd64              1.0.4-3ubuntu2                amd64        Micro string library: shared library\\nii  libuuid1:amd64                   2.20.1-5.1ubuntu20.1          amd64        Universally Unique ID library\\nii  libv4l-0:amd64                   1.0.1-1                       amd64        Collection of video4linux support libraries\\nii  libv4lconvert0:amd64             1.0.1-1                       amd64        Video4linux frame format conversion library\\nii  libvarnishapi1                   3.0.5-2                       amd64        shared libraries for Varnish\\nii  libvirt0                         1.2.2-0ubuntu13.1.2           amd64        library for interfacing with different virtualization systems\\nii  libvorbis0a:amd64                1.3.2-1.3ubuntu1              amd64        The Vorbis General Audio Compression Codec (Decoder library)\\nii  libvorbisenc2:amd64              1.3.2-1.3ubuntu1              amd64        The Vorbis General Audio Compression Codec (Encoder library)\\nii  libvorbisfile3:amd64             1.3.2-1.3ubuntu1              amd64        The Vorbis General Audio Compression Codec (High Level API)\\nii  libvpx1:amd64                    1.3.0-2                       amd64        VP8 video codec (shared library)\\nii  libwayland-client0:amd64         1.4.0-1ubuntu1                amd64        wayland compositor infrastructure - client library\\nii  libwayland-cursor0:amd64         1.4.0-1ubuntu1                amd64        wayland compositor infrastructure - cursor library\\nii  libwind0-heimdal:amd64           1.6~git20131207+dfsg-1ubuntu1 amd64        Heimdal Kerberos - stringprep implementation\\nii  libwrap0:amd64                   7.6.q-25                      amd64        Wietse Venema's TCP wrappers library\\nii  libx11-6:amd64                   2:1.6.2-1ubuntu2              amd64        X11 client-side library\\nii  libx11-data                      2:1.6.2-1ubuntu2              all          X11 client-side library\\nii  libx11-xcb1:amd64                2:1.6.2-1ubuntu2              amd64        Xlib/XCB interface library\\nii  libxau6:amd64                    1:1.0.8-1                     amd64        X11 authorisation library\\nii  libxaw7:amd64                    2:1.0.12-1                    amd64        X11 Athena Widget library\\nii  libxcb-dri2-0:amd64              1.10-2ubuntu1                 amd64        X C Binding, dri2 extension\\nii  libxcb-dri3-0:amd64              1.10-2ubuntu1                 amd64        X C Binding, dri3 extension\\nii  libxcb-glx0:amd64                1.10-2ubuntu1                 amd64        X C Binding, glx extension\\nii  libxcb-present0:amd64            1.10-2ubuntu1                 amd64        X C Binding, present extension\\nii  libxcb-render0:amd64             1.10-2ubuntu1                 amd64        X C Binding, render extension\\nii  libxcb-shape0:amd64              1.10-2ubuntu1                 amd64        X C Binding, shape extension\\nii  libxcb-shm0:amd64                1.10-2ubuntu1                 amd64        X C Binding, shm extension\\nii  libxcb-sync1:amd64               1.10-2ubuntu1                 amd64        X C Binding, sync extension\\nii  libxcb1:amd64                    1.10-2ubuntu1                 amd64        X C Binding\\nii  libxcomposite1:amd64             1:0.4.4-1                     amd64        X11 Composite extension library\\nii  libxcursor1:amd64                1:1.1.14-1                    amd64        X cursor management library\\nii  libxdamage1:amd64                1:1.1.4-1ubuntu1              amd64        X11 damaged region extension library\\nii  libxdmcp6:amd64                  1:1.1.1-1                     amd64        X11 Display Manager Control Protocol library\\nii  libxext6:amd64                   2:1.3.2-1                     amd64        X11 miscellaneous extension library\\nii  libxfixes3:amd64                 1:5.0.1-1ubuntu1              amd64        X11 miscellaneous 'fixes' extension library\\nii  libxft2:amd64                    2.3.1-2                       amd64        FreeType-based font drawing library for X\\nii  libxi6:amd64                     2:1.7.1.901-1ubuntu1          amd64        X11 Input extension library\\nii  libxinerama1:amd64               2:1.1.3-1                     amd64        X11 Xinerama extension library\\nii  libxkbcommon0:amd64              0.4.1-0ubuntu1                amd64        library interface to the XKB compiler - shared library\\nii  libxml2:amd64                    2.9.1+dfsg1-3ubuntu4.3        amd64        GNOME XML library\\nii  libxmu6:amd64                    2:1.1.1-1                     amd64        X11 miscellaneous utility library\\nii  libxmuu1:amd64                   2:1.1.1-1                     amd64        X11 miscellaneous micro-utility library\\nii  libxpm4:amd64                    1:3.5.10-1                    amd64        X11 pixmap library\\nii  libxrandr2:amd64                 2:1.4.2-1                     amd64        X11 RandR extension library\\nii  libxrender1:amd64                1:0.9.8-1                     amd64        X Rendering Extension client library\\nii  libxshmfence1:amd64              1.1-2                         amd64        X shared memory fences - shared library\\nii  libxt6:amd64                     1:1.1.4-1                     amd64        X11 toolkit intrinsics library\\nii  libxtables10                     1.4.21-1ubuntu1               amd64        netfilter xtables library\\nii  libxtst6:amd64                   2:1.2.2-1                     amd64        X11 Testing -- Record extension library\\nii  libxv1:amd64                     2:1.0.10-1                    amd64        X11 Video extension library\\nii  libxxf86dga1:amd64               2:1.1.4-1                     amd64        X11 Direct Graphics Access extension library\\nii  libxxf86vm1:amd64                1:1.1.3-1                     amd64        X11 XFree86 video mode extension library\\nii  libyajl2:amd64                   2.0.4-4                       amd64        Yet Another JSON Library\\nii  libyaml-0-2:amd64                0.1.4-3ubuntu3                amd64        Fast YAML 1.1 parser and emitter library\\nii  locales                          2.13+git20120306-12.1         all          common files for locale support\\nii  lockfile-progs                   0.1.17                        amd64        Programs for locking and unlocking files and mailboxes\\nii  login                            1:4.1.5.1-1ubuntu9            amd64        system login tools\\nii  logrotate                        3.8.7-1ubuntu1                amd64        Log rotation utility\\nii  lsb-base                         4.1+Debian11ubuntu6           all          Linux Standard Base 4.1 init script functionality\\nii  lsb-release                      4.1+Debian11ubuntu6           all          Linux Standard Base version reporting utility\\nii  makedev                          2.3.1-93ubuntu1               all          creates device files in /dev\\nii  mawk                             1.3.3-17ubuntu2               amd64        a pattern scanning and text processing language\\nii  mime-support                     3.54ubuntu1                   all          MIME files 'mime.types' & 'mailcap', and support programs\\nii  module-init-tools                15-0ubuntu6                   all          transitional dummy package (module-init-tools to kmod)\\nii  mount                            2.20.1-5.1ubuntu20.1          amd64        Tools for mounting and manipulating filesystems\\nii  mountall                         2.53                          amd64        filesystem mounting tool\\nii  multiarch-support                2.19-0ubuntu6.3               amd64        Transitional package to ensure multiarch compatibility\\nii  mysql-common                     5.5.38-0ubuntu0.14.04.1       all          MySQL database common files, e.g. /etc/mysql/my.cnf\\nii  ncurses-base                     5.9+20140118-1ubuntu1         all          basic terminal type definitions\\nii  ncurses-bin                      5.9+20140118-1ubuntu1         amd64        terminal-related programs and man pages\\nii  net-tools                        1.60-25ubuntu2.1              amd64        The NET-3 networking toolkit\\nii  netbase                          5.2                           all          Basic TCP/IP networking system\\nii  netcat-openbsd                   1.105-7ubuntu1                amd64        TCP/IP swiss army knife\\nii  notification-daemon              0.7.6-1                       amd64        daemon for displaying passive pop-up notifications\\nii  ntfs-3g                          1:2013.1.13AR.1-2ubuntu2      amd64        read/write NTFS driver for FUSE\\nii  ntpdate                          1:4.2.6.p5+dfsg-3ubuntu2      amd64        client for setting system time from NTP servers\\nii  openjdk-7-jre:amd64              7u65-2.5.1-4ubuntu1~0.14.04.2 amd64        OpenJDK Java runtime, using Hotspot JIT\\nii  openjdk-7-jre-headless:amd64     7u65-2.5.1-4ubuntu1~0.14.04.2 amd64        OpenJDK Java runtime, using Hotspot JIT (headless)\\nii  openssh-client                   1:6.6p1-2ubuntu2              amd64        secure shell (SSH) client, for secure access to remote machines\\nii  openssh-server                   1:6.6p1-2ubuntu2              amd64        secure shell (SSH) server, for secure access from remote machines\\nii  openssh-sftp-server              1:6.6p1-2ubuntu2              amd64        secure shell (SSH) sftp server module, for SFTP access from remote machines\\nii  openssl                          1.0.1f-1ubuntu2.5             amd64        Secure Sockets Layer toolkit - cryptographic utility\\nii  parted                           2.3-19ubuntu1                 amd64        disk partition manipulator\\nii  passwd                           1:4.1.5.1-1ubuntu9            amd64        change and administer password and group data\\nii  patch                            2.7.1-4ubuntu1                amd64        Apply a diff file to an original\\nii  perl                             5.18.2-2ubuntu1               amd64        Larry Wall's Practical Extraction and Report Language\\nii  perl-base                        5.18.2-2ubuntu1               amd64        minimal Perl system\\nii  perl-modules                     5.18.2-2ubuntu1               all          Core Perl modules\\nii  plymouth                         0.8.8-0ubuntu17               amd64        graphical boot animation and logger - main package\\nii  policykit-1                      0.105-4ubuntu2                amd64        framework for managing administrative policies and privileges\\nii  policykit-1-gnome                0.105-1ubuntu4                amd64        GNOME authentication agent for PolicyKit-1\\nii  procps                           1:3.3.9-1ubuntu2              amd64        /proc file system utilities\\nii  psmisc                           22.20-1ubuntu2                amd64        utilities that use the proc file system\\nii  python                           2.7.5-5ubuntu3                amd64        interactive high-level object-oriented language (default version)\\nii  python-minimal                   2.7.5-5ubuntu3                amd64        minimal subset of the Python language (default version)\\nii  python-yaml                      3.10-4build4                  amd64        YAML parser and emitter for Python\\nii  python2.7                        2.7.6-8                       amd64        Interactive high-level object-oriented language (version 2.7)\\nii  python2.7-minimal                2.7.6-8                       amd64        Minimal subset of the Python language (version 2.7)\\nii  python3                          3.4.0-0ubuntu2                amd64        interactive high-level object-oriented language (default python3 version)\\nii  python3-minimal                  3.4.0-0ubuntu2                amd64        minimal subset of the Python language (default python3 version)\\nii  python3.4                        3.4.0-2ubuntu1                amd64        Interactive high-level object-oriented language (version 3.4)\\nii  python3.4-minimal                3.4.0-2ubuntu1                amd64        Minimal subset of the Python language (version 3.4)\\nii  readline-common                  6.3-4ubuntu2                  all          GNU readline and history libraries, common files\\nii  resolvconf                       1.69ubuntu1.1                 all          name server information handler\\nii  rrdtool                          1.4.7-2ubuntu5                amd64        time-series data storage and display system (programs)\\nii  rsync                            3.1.0-2ubuntu0.1              amd64        fast, versatile, remote (and local) file-copying tool\\nii  rsyslog                          7.4.4-1ubuntu2.1              amd64        reliable system and kernel logging daemon\\nii  sed                              4.2.2-4ubuntu1                amd64        The GNU sed stream editor\\nii  sensible-utils                   0.0.9                         all          Utilities for sensible alternative selection\\nii  sgml-base                        1.26+nmu4ubuntu1              all          SGML infrastructure and SGML catalog file support\\nii  shared-mime-info                 1.2-0ubuntu3                  amd64        FreeDesktop.org shared MIME database and spec\\nii  sound-theme-freedesktop          0.8-1                         all          freedesktop.org sound theme\\nii  ssh                              1:6.6p1-2ubuntu2              all          secure shell client and server (metapackage)\\nii  subutai-mastertemplate-setup     1.0.0                         amd64        Necessary Scripts and Files For Creating Master Template\\nii  sudo                             1.8.9p5-1ubuntu1              amd64        Provide limited super user privileges to specific users\\nii  systemd-services                 204-5ubuntu20.6               amd64        systemd runtime services\\nii  systemd-shim                     6-2bzr1                       amd64        shim for systemd\\nii  sysv-rc                          2.88dsf-41ubuntu6             all          System-V-like runlevel change mechanism\\nii  sysvinit-utils                   2.88dsf-41ubuntu6             amd64        System-V-like utilities\\nii  tar                              1.27.1-1                      amd64        GNU version of the tar archiving utility\\nii  ttf-dejavu                       2.34-1ubuntu1                 all          transitional dummy package\\nii  ttf-dejavu-core                  2.34-1ubuntu1                 all          transitional dummy package\\nii  ttf-dejavu-extra                 2.34-1ubuntu1                 all          transitional dummy package\\nii  tzdata                           2014e-0ubuntu0.14.04          all          time zone and daylight-saving time data\\nii  tzdata-java                      2014e-0ubuntu0.14.04          all          time zone and daylight-saving time data for use by java runtimes\\nii  ubuntu-keyring                   2012.05.19                    all          GnuPG keys of the Ubuntu archive\\nii  ubuntu-minimal                   1.325                         amd64        Minimal core of Ubuntu\\nii  ucf                              3.0027+nmu1                   all          Update Configuration File(s): preserve user changes to config files\\nii  udev                             204-5ubuntu20.6               amd64        /dev/ and hotplug management daemon\\nii  udisks2                          2.1.3-1                       amd64        D-BUS service to access and manipulate storage devices\\nii  upstart                          1.12.1-0ubuntu4.2             amd64        event-based init daemon\\nii  ureadahead                       0.100.0-16                    amd64        Read required files in advance\\nii  util-linux                       2.20.1-5.1ubuntu20.1          amd64        Miscellaneous system utilities\\nii  vim                              2:7.4.052-1ubuntu3            amd64        Vi IMproved - enhanced vi editor\\nii  vim-common                       2:7.4.052-1ubuntu3            amd64        Vi IMproved - Common files\\nii  vim-runtime                      2:7.4.052-1ubuntu3            all          Vi IMproved - Runtime files\\nii  vim-tiny                         2:7.4.052-1ubuntu3            amd64        Vi IMproved - enhanced vi editor - compact version\\nii  whiptail                         0.52.15-2ubuntu5              amd64        Displays user-friendly dialog boxes from shell scripts\\nii  x11-common                       1:7.7+1ubuntu8                all          X Window System (X.Org) infrastructure\\nii  x11-utils                        7.7+1                         amd64        X11 utilities\\nii  xkb-data                         2.10.1-1ubuntu1               all          X Keyboard Extension (XKB) configuration data\\nii  xml-core                         0.13+nmu2                     all          XML infrastructure and XML catalog file support\\nii  zlib1g:amd64                     1:1.2.8.dfsg-1ubuntu1         amd64        compression library - runtime\\n\",\n"
            + "    \"products\": [\n" + "        \"ksks-logstash\"\n" + "    ],\n"
            + "    \"md5sum\": \"ec6c39f0aed6b6a1256321d2e927a392\",\n" + "    \"faisUsingThisTemplate\": []\n" + "}";

    private static String packagesInfo = "ksks-logstash\nADT";
    private final String TEMPLATE_ARCH_FORMAT = "%s-%s";
    private String templateName = "templateRegistryImplTestName";
    private int counter = 0;


    private static class CustomIterator implements Iterator
    {
        Row row;
        AtomicBoolean atomicBoolean;


        public CustomIterator()
        {
            atomicBoolean = new AtomicBoolean( true );
            row = mock( Row.class );
            when( row.getString( "info" ) ).thenReturn( templateInfo );
        }


        @Override
        public boolean hasNext()
        {
            return atomicBoolean.getAndSet( false );
        }


        @Override
        public Object next()
        {
            return row;
        }


        @Override
        public void remove()
        {

        }
    }


    @Before
    public void setupClasses() throws DBException
    {
        dbManager = mock( DbManager.class );

        ResultSet rsQuery = mock( ResultSet.class );
        Iterator itQuery = mock( Iterator.class );
        Row row = mock( Row.class );
        when( row.getString( "info" ) ).thenReturn( templateInfo );
        when( rsQuery.iterator() ).thenReturn( itQuery );
        when( itQuery.hasNext() ).thenReturn( true );
        when( itQuery.next() ).thenReturn( row );
        when( dbManager.executeQuery2( "select info from template_registry_info where template = ?",
                String.format( TEMPLATE_ARCH_FORMAT, templateName.toLowerCase(),
                        Common.DEFAULT_LXC_ARCH.toLowerCase() ) ) ).thenReturn( rsQuery );

        ResultSet rs = mock( ResultSet.class );
        Iterator it = mock( Iterator.class );
        when( it.hasNext() ).thenReturn( false );
        when( it.next() ).thenReturn( templateInfo );
        when( rs.iterator() ).thenReturn( it );


        when( dbManager.executeQuery2( any( String.class ), anyVararg() ) ).thenReturn( rs );

        templateRegistry = new TemplateRegistryImpl( dbManager );
    }


    @Test
    public void shouldCallDbManagerExecuteQueryOnRegisterTemplate() throws RegistryException, DBException
    {
        //        templateRegistry.registerTemplate( mock(String.class), mock(String.class), mock(String.class) );
        templateRegistry.registerTemplate( configFile, "packagesFile", "md5sum" );
        verify( dbManager ).executeUpdate2( any( String.class ), anyVararg() );
    }


    @Test
    public void shouldCallDbManagerExecuteUpdateOnUnregisteredTemplate() throws RegistryException, DBException
    {
        ResultSet rsQuery = mock( ResultSet.class );
        CustomIterator itQuery = new CustomIterator();
        when( rsQuery.iterator() ).thenReturn( itQuery );
        when( dbManager.executeQuery2( "select info from template_registry_info where template = ?",
                String.format( TEMPLATE_ARCH_FORMAT, templateName.toLowerCase(),
                        Common.DEFAULT_LXC_ARCH.toLowerCase() ) ) ).thenReturn( rsQuery );

        //        TemplateRegistryImpl templateRegistry = new TemplateRegistryImpl( dbManager );
        templateRegistry.unregisterTemplate( templateName );
        verify( dbManager ).executeUpdate2( any( String.class ), anyVararg() );
    }


    @Test
    public void shouldTestTemplateDifferenceFromParentOnPackagesDiff()
    {
        Template template = mock( Template.class );
        when( template.getParentTemplateName() ).thenReturn( null );
        when( template.getPackagesManifest() ).thenReturn( "" );
        templateRegistry.getPackagesDiff( template );
    }


    @Test
    public void shouldCallDbManagerExecuteUpdateOnUnregisteredTemplateWithTwoParameters()
            throws DBException, RegistryException
    {
        ResultSet rsQuery = mock( ResultSet.class );
        CustomIterator itQuery = new CustomIterator();
        when( rsQuery.iterator() ).thenReturn( itQuery );
        when( dbManager.executeQuery2( "select info from template_registry_info where template = ?",
                String.format( TEMPLATE_ARCH_FORMAT, templateName.toLowerCase(),
                        Common.DEFAULT_LXC_ARCH.toLowerCase() ) ) ).thenReturn( rsQuery );

        //        TemplateRegistryImpl templateRegistry = new TemplateRegistryImpl( dbManager );
        templateRegistry.unregisterTemplate( templateName, Common.DEFAULT_LXC_ARCH );
        verify( dbManager ).executeUpdate2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetTemplate() throws DBException
    {
        templateRegistry.getTemplate( templateName );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetTemplateWithTwoParameters() throws DBException
    {
        templateRegistry.getTemplate( templateName, Common.DEFAULT_LXC_ARCH );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetChildTemplates() throws DBException
    {
        templateRegistry.getChildTemplates( templateName );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetChildTemplatesWithTwoParameters() throws DBException
    {
        templateRegistry.getChildTemplates( templateName, Common.DEFAULT_LXC_ARCH );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetParentTemplate() throws DBException
    {
        templateRegistry.getParentTemplate( templateName );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetParentTemplateWithTwoParameters() throws DBException
    {
        templateRegistry.getParentTemplate( templateName, Common.DEFAULT_LXC_ARCH );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetTemplateTree() throws DBException
    {
        templateRegistry.getTemplateTree();
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetParentTemplates() throws DBException
    {
        templateRegistry.getParentTemplates( templateName );
        //        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetParentTemplatesWithTwoParameters() throws DBException
    {
        templateRegistry.getParentTemplates( templateName, Common.DEFAULT_LXC_ARCH );
        //        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testGetAllTemplates() throws DBException
    {
        templateRegistry.getAllTemplates();
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void getAllTemplatesWithParameter() throws DBException
    {
        templateRegistry.getAllTemplates( Common.DEFAULT_LXC_ARCH );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testUpdateTemplateUsage() throws RegistryException, DBException
    {
        ResultSet rsQuery = mock( ResultSet.class );
        CustomIterator itQuery = new CustomIterator();
        when( rsQuery.iterator() ).thenReturn( itQuery );
        when( dbManager.executeQuery2( "select info from template_registry_info where template = ?",
                String.format( TEMPLATE_ARCH_FORMAT, templateName.toLowerCase(),
                        Common.DEFAULT_LXC_ARCH.toLowerCase() ) ) ).thenReturn( rsQuery );

        templateRegistry.updateTemplateUsage( "faiHostName", templateName, true );
        verify( dbManager ).executeQuery2( any( String.class ), anyVararg() );
    }


    @Test
    public void testIsTemplateInUse() throws RegistryException, DBException
    {
        ResultSet rsQuery = mock( ResultSet.class );
        CustomIterator itQuery = new CustomIterator();
        when( rsQuery.iterator() ).thenReturn( itQuery );
        when( dbManager.executeQuery2( "select info from template_registry_info where template = ?",
                String.format( TEMPLATE_ARCH_FORMAT, templateName.toLowerCase(),
                        Common.DEFAULT_LXC_ARCH.toLowerCase() ) ) ).thenReturn( rsQuery );
        templateRegistry.isTemplateInUse( templateName );
    }
}

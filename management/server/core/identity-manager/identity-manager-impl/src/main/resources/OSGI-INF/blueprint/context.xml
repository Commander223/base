<blueprint xmlns:jpa="http://aries.apache.org/xmlns/jpa/v1.0.0"
           xmlns:jaas="http://karaf.apache.org/xmlns/jaas/v1.1.0"
           default-activation="eager"
           xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    >

  <!--*****************************************************************-->
  <bean id="daoManagerSecurity" init-method="init" activation="eager" scope="singleton"
        class="io.subutai.common.dao.DaoManager">
    <jpa:unit unitname="identityManagerPUnit" property="entityManagerFactory" />
  </bean>
  <!--*****************************************************************-->

  <bean id="identityManager" scope="singleton" activation="eager"
        init-method="init" depends-on="daoManagerSecurity"
        class="io.subutai.core.identity.impl.IdentityManagerImpl">
    <argument ref="daoManagerSecurity" />
  </bean>

  <service ref="identityManager" activation="eager"
           interface="io.subutai.core.identity.api.IdentityManager" />

  <jaas:config name="karaf" rank="5">
    <jaas:module flags="required" name="Subutai"
                 className="io.subutai.core.identity.impl.ShiroLoginModule">
    </jaas:module>
  </jaas:config>

  <service ref="identityManager"
           interface="org.apache.felix.gogo.api.CommandSessionListener" />

  </blueprint>

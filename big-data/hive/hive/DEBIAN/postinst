#!/bin/sh

# Exit on error
set -e

tar -xpzf /opt/hive-0.11.0-bin.tar.gz -C /opt
rm -rf /opt/hive-0.11.0-bin.tar.gz

FilePath="/etc/profile"
hiveHomeEcho="/opt/hive-0.11.0-bin"
hivePath="\/opt\/hive-0.11.0-bin\/bin"
hivePathEcho=$hiveHomeEcho"/bin"

# Add hive home       
if grep -q "HIVE_HOME" $FilePath
then
    echo "HIVE_HOME is already added!"
else
        echo "Hive path is being inserted"
        # Add Hive Install Path to the /etc/profile file
	echo "HIVE_HOME="$hiveHomeEcho >> $FilePath
fi

# Add hive bin directory to the path
if grep -q "export PATH=" $FilePath
then
        echo "Path is previously insterted to" $FilePath
        if grep -q "${hivePath}" $FilePath
        then
                echo "Hive path is already inserted!!!"
        else
                echo "Hive path is being insterted!"
                sed -i "s/export PATH=/export PATH=$hivePath:/1" $FilePath
        fi
else
        echo "PATH is being inserted for the first time"
        echo "export PATH=$PATH:$hivePathEcho" >> "${FilePath}"
fi
. $FilePath

#hadoop dfsadmin -safemode leave        
##Create /tmp directory in hdfs if does not exist
#if hadoop fs -test -d /tmp ; then
#        echo "/tmp directory exists!"
#else
#        hadoop fs -mkdir /tmp
#	hadoop fs -chmod g+w /tmp
#fi
##Create user/hive/warehouse in hdfs if does not exist
#if hadoop fs -test -d /user/hive/warehouse ; then
#        echo "/user/hive/warehouse directory exists!"
#else
#        hadoop fs -mkdir /user/hive/warehouse
#	hadoop fs -chmod g+w /user/hive/warehouse
#fi

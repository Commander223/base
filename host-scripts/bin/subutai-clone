#!/bin/bash

# sources everything else we need
. /etc/subutai/funcs

parent="$1"
child="$2"

function usage {
  echo -----------------------------------------------------------------------
  echo Usage: Clone a new non-existant child from an existing parent container.
  echo
  echo "	"subutai-clone parent child
  echo
  echo -----------------------------------------------------------------------
}

if [ -z "$parent" ]; then
  msg_error "Parameters not provided. Aborting ..."
  show_usage "`usage`"
fi

if [ -z "$child" ]; then
  msg_error "Child parameter not provided. Aborting ..."
  show_usage "`usage`"
fi

# NOTE: underscore for our own lxc clone impl not supplied lxc-clone
lxc_clone $parent $child "`usage`"

lxc-start -d -n $child
lxc-wait -n $child -s RUNNING
lxc-attach -n $child -- git checkout -b $child

msg_ok "Successfully cloned $child container from $parent"

